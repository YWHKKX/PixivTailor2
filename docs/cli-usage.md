# PixivTailor CLI 使用说明

## 概述

PixivTailor 提供统一的命令行接口，支持Pixiv爬虫功能和AI图像生成功能。通过Web界面提供更丰富的功能体验。

## 基本语法

使用 `tailor.exe` 命令后跟全局选项、命令和命令选项。

## 全局选项

- **--help**: 显示帮助信息
- **--version**: 显示版本信息
- **--config**: 指定配置文件路径
- **--verbose**: 详细输出模式

## 命令列表

### 1. server - 启动Web服务器 ✅

启动PixivTailor的Web服务器，提供Web界面和API服务。

#### 功能描述
- 启动HTTP服务器 (端口: 50052)
- 启动gRPC服务器 (端口: 50051)
- 启动WebSocket服务 (实时通信)
- 提供REST API接口
- 服务静态文件
- 支持固定端口策略

#### 基本用法
- 启动服务器：直接运行 `tailor.exe server`
- 指定端口启动：使用 `--port` 参数指定端口
- 指定数据库：使用 `--db` 参数指定数据库路径
- 指定配置：使用 `--config` 参数指定配置文件

#### 端口配置
- **固定端口策略**: 默认使用gRPC端口50051，HTTP端口50052
- **端口检测**: 自动检测端口可用性
- **端口释放**: 自动释放被占用的端口
- **端口查找**: 自动查找可用端口

#### 访问地址
- **Web界面**: 需要单独启动前端服务
- **API接口**: 提供REST API接口服务
- **WebSocket**: 提供实时通信服务
- **gRPC**: 提供gRPC服务

### 2. crawl - 爬取Pixiv插画 ✅

爬取Pixiv插画数据，支持按标签、用户或插画ID搜索。

#### 功能描述
- 按标签搜索插画
- 按用户ID爬取用户作品
- 按插画ID下载特定作品
- 支持多种排序方式和内容模式
- 自动下载图片到指定目录

#### 主要选项
- **--query**: 搜索关键词（标签搜索时使用）
- **--user-id**: 用户ID（用户作品爬取时使用）
- **--illust-id**: 插画ID（单图下载时使用）
- **--order**: 排序方式（按时间或热度）
- **--mode**: 内容模式（安全、R18、全模式）
- **--limit**: 最大下载数量限制
- **--delay**: 请求延迟时间
- **--output**: 输出保存目录
- **--proxy**: 代理服务器地址
- **--cookie**: Pixiv Cookie

#### 使用场景
- 按标签批量下载插画
- 下载特定用户的所有作品
- 下载指定的插画作品

### 2. generate - 生成AI图像 ✅

使用Stable Diffusion WebUI生成AI图像。

#### 功能描述
- 使用Stable Diffusion生成AI图像
- 支持LoRA模型组合使用
- 支持批量图像生成
- 支持自定义参数配置
- 支持多种输出格式
- 支持WebUI管理
- 支持任务监控

#### 主要选项
- **model**: 基础模型名称（必需）
- **prompt**: 正面提示词（必需）
- **negative-prompt**: 负面提示词
- **lora**: LoRA模型配置
- **batch-size**: 批次生成数量
- **steps**: 采样步数
- **cfg-scale**: CFG Scale参数
- **width/height**: 图像尺寸
- **seed**: 随机种子
- **output**: 输出保存目录
- **config**: 使用配置文件

#### 使用场景
- 使用LoRA模型生成特定风格图像
- 批量生成训练数据
- 测试不同的生成参数
- 通过Web界面进行可视化操作

### 3. train - 训练LoRA模型

使用Kohya-ss训练LoRA模型。

#### 功能描述
- 训练自定义LoRA模型
- 支持多标签联合训练
- 支持训练参数优化
- 支持训练进度监控
- 支持训练任务管理

#### 主要选项
- **model-name**: 模型名称（必需）
- **training-data**: 训练数据目录（必需）
- **pretrained-model**: 预训练模型路径
- **epochs**: 训练轮数
- **batch-size**: 批次大小
- **learning-rate**: 学习率
- **output**: 输出目录

#### 使用场景
- 训练角色LoRA模型
- 训练风格LoRA模型
- 训练特定概念的LoRA模型

### 4. tag - 生成图像标签

使用WD14Tagger为图像生成标签。

#### 功能描述
- 自动为图像生成标签
- 支持多种标签分析器
- 支持标签过滤和扩展
- 支持批量图像处理
- 支持多种输出格式

#### 主要选项
- **input**: 输入图像目录（必需）
- **output**: 输出目录
- **analyzer**: 分析器类型
- **threshold**: 标签阈值
- **save-type**: 保存格式

#### 使用场景
- 为训练数据生成标签
- 批量处理图像标签
- 标签质量评估

### 5. classify - 分类标签

使用OpenAI对标签进行智能分类。

#### 功能描述
- 智能分类图像标签
- 生成全局标签分类文件
- 支持自定义分类规则
- 支持多API密钥轮换

#### 主要选项
- **input**: 输入标签文件（必需）
- **output**: 输出分类文件
- **categories**: 分类类别

#### 使用场景
- 整理和分类标签数据
- 生成标签分类规则
- 优化标签管理系统

### 6. server - 启动gRPC服务器

启动gRPC服务器提供API服务。

#### 功能描述
- 启动gRPC API服务器
- 提供远程调用接口
- 支持服务发现
- 支持负载均衡

#### 主要选项
- **port**: 服务器端口
- **db**: 数据库文件路径 (默认: data/database/pixiv_tailor.db)

#### 使用场景
- 提供远程API服务
- 集成到其他系统
- 分布式部署

## 配置说明

### 配置文件结构
- **系统配置**: 基础系统设置
- **模块配置**: 各功能模块配置
- **用户配置**: 用户个性化设置

### 主要配置项
- **Pixiv配置**: Cookie、代理、API地址等
- **AI配置**: Stable Diffusion、Kohya-ss、OpenAI等
- **下载配置**: 保存目录、文件格式等
- **日志配置**: 日志级别、输出格式等

## 使用建议

### 1. 环境准备
- 确保所有依赖服务正常运行
- 配置正确的API密钥和Cookie
- 设置合适的网络代理（如需要）

### 2. 参数调优
- 根据硬件配置调整并发数量
- 根据网络情况调整延迟时间
- 根据需求调整生成参数

### 3. 错误处理
- 查看详细日志信息
- 检查网络连接状态
- 验证配置文件格式

### 4. 性能优化
- 使用批量处理提高效率
- 合理设置缓存参数
- 监控系统资源使用情况

## 注意事项

### 1. 合规使用
- 遵守Pixiv使用条款
- 尊重版权规定
- 合理使用API服务

### 2. 数据安全
- 保护API密钥安全
- 妥善处理用户数据
- 定期备份重要数据

### 3. 系统维护
- 定期更新依赖服务
- 监控系统运行状态
- 及时处理错误和异常