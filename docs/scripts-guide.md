# PixivTailor 脚本使用指南

本文档详细介绍了PixivTailor项目中的所有启动和管理脚本，帮助用户快速理解和使用各种启动方式。所有脚本已更新并适配当前项目状态。

## 📋 脚本概览

| 脚本名称              | 功能          | 适用场景       | 端口             | 状态 |
| --------------------- | ------------- | -------------- | ---------------- | ---- |
| `start-dev.bat`       | 开发模式启动  | 本地开发调试   | 3000/50051/50052 | ✅    |
| `start-webui-api.bat` | WebUI API启动 | 启动WebUI服务  | 7860             | ✅    |
| `kill-webui.bat`      | 停止WebUI服务 | 清理WebUI进程  | -                | ✅    |
| `stop.bat`            | 停止所有服务  | 清理运行的服务 | -                | ✅    |
| `build.sh`            | 构建脚本      | Linux/Mac构建  | -                | ✅    |

## 🚀 启动脚本详解

### 1. start-dev.bat - 开发模式启动 ✅

**功能描述**: 专门用于本地开发的轻量级启动脚本

**特点**:
- 🏃‍♂️ 快速启动（跳过Docker检查）
- 🔧 仅支持本地开发模式
- 📦 自动安装依赖
- 🌐 自动打开浏览器
- 🔧 支持固定端口策略
- 📊 实时状态监控

**启动流程**:
1. 环境检查（Go、Node.js）
2. 目录结构创建
3. 依赖安装
4. 启动后端和前端服务
5. 端口检测和状态监控

**端口配置**:
- **前端**: 3000端口（自动检测可用端口）
- **后端HTTP**: 50052端口（固定端口）
- **后端gRPC**: 50051端口（固定端口）

**使用场景**:
- 日常开发调试
- 快速启动开发环境
- 不需要Docker环境
- AI图像生成功能开发

### 2. start-webui-api.bat - WebUI API启动 ✅

**功能描述**: 启动Stable Diffusion WebUI服务

**特点**:
- 🎨 启动Stable Diffusion WebUI
- 🔧 自动配置API接口
- 📊 提供WebUI管理功能
- 🌐 支持外部访问

**启动流程**:
1. 检查WebUI环境
2. 启动WebUI服务
3. 配置API接口
4. 提供管理功能

**端口配置**:
- **WebUI**: 7860端口

**使用场景**:
- AI图像生成
- WebUI服务管理
- 外部API调用

### 3. kill-webui.bat - 停止WebUI服务 ✅

**功能描述**: 停止Stable Diffusion WebUI服务

**特点**:
- 🛑 强制停止WebUI进程
- 🔧 清理相关资源
- 📊 状态检查

**使用场景**:
- 清理WebUI进程
- 重启WebUI服务
- 故障恢复

### 3. start-prod.bat - 生产模式启动

**功能描述**: 专门用于生产环境的Docker部署脚本

**特点**:
- 🐳 强制使用Docker模式
- 🔄 自动构建和重启服务
- 📊 提供监控和管理命令
- 🛡️ 生产级别的错误处理

**启动流程**:
1. Docker环境检查
2. 停止现有服务
3. 构建Docker镜像
4. 启动生产服务
5. 服务状态检查

**使用场景**:
- 生产环境部署
- 正式发布版本
- 需要容器化部署

### 4. start-server.bat - 仅启动后端服务器

**功能描述**: 只启动gRPC后端服务器，不启动前端

**特点**:
- 🎯 专注于后端服务
- 🔧 自动编译CLI工具
- 📦 自动生成gRPC代码
- 🛠️ 适合API开发和测试

**启动流程**:
1. Go环境检查
2. 编译CLI工具
3. 生成gRPC代码
4. 启动后端服务器

**使用场景**:
- API开发和测试
- 后端服务调试
- 不需要前端界面

## 🔧 管理脚本详解

### 4. stop.bat - 停止所有服务 ✅

**功能描述**: 停止所有运行的服务和进程

**停止内容**:
- Docker服务（docker-compose down）
- 后端进程（端口50051、50052）
- 前端进程（端口3000）
- Node.js进程
- WebUI进程

**使用场景**:
- 清理运行环境
- 重启服务前清理
- 故障恢复

### 5. build.sh - Linux/Mac构建脚本 ✅

**功能描述**: 用于Linux和Mac系统的构建脚本

**特点**:
- 🐧 跨平台支持
- 🔧 Go版本检查
- 📦 依赖管理
- 📖 使用帮助

## 📊 脚本对比分析

### 当前脚本状态

| 特性      | start-dev.bat | start-webui-api.bat | kill-webui.bat | stop.bat |
| --------- | ------------- | ------------------- | -------------- | -------- |
| 开发支持  | ✅ 是          | ❌ 否                | ❌ 否           | ❌ 否     |
| WebUI支持 | ❌ 否          | ✅ 是                | ✅ 是           | ✅ 是     |
| 端口管理  | ✅ 是          | ✅ 是                | ❌ 否           | ✅ 是     |
| 状态监控  | ✅ 是          | ✅ 是                | ❌ 否           | ❌ 否     |
| 适用场景  | 开发调试      | WebUI管理           | 清理WebUI      | 环境清理 |

### 端口配置说明

**固定端口策略**:
- **gRPC端口**: 50051（固定）
- **HTTP端口**: 50052（固定）
- **前端端口**: 3000（自动检测）
- **WebUI端口**: 7860（固定）

**端口检测机制**:
- 自动检测端口可用性
- 自动释放被占用的端口
- 自动查找可用端口
- 提供详细的端口状态信息

## 🎯 推荐使用方式

### 开发环境
```bash
# 推荐使用 start-dev.bat
.\start-dev.bat
```

### WebUI服务管理
```bash
# 启动WebUI服务
.\start-webui-api.bat

# 停止WebUI服务
.\kill-webui.bat
```

### 服务管理
```bash
# 停止所有服务
.\stop.bat
```

### Linux/Mac环境
```bash
# 构建项目
.\build.sh
```

## 📝 总结

PixivTailor项目提供了完整的脚本生态系统，支持从开发到生产的各种场景。主要脚本包括：

- **start-dev.bat**: 开发模式启动，适合日常开发
- **start-webui-api.bat**: WebUI服务管理，适合AI图像生成
- **kill-webui.bat**: WebUI服务停止，适合服务清理
- **stop.bat**: 服务停止，适合环境清理
- **build.sh**: 构建脚本，适合Linux/Mac环境

所有脚本已更新并适配当前项目状态，支持固定端口策略和实时状态监控。建议根据具体使用场景选择合适的脚本。
